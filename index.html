<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Language Learning Stories</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container">
      <h1>Language Learning Stories</h1>
      <div class="path-container">
        <div class="url-path" id="urlPath">
          <span class="path-segment">root</span>
        </div>
        <div class="full-url" id="fullUrl"></div>
      </div>
      <div class="file-explorer">
        <div class="folders" id="folderList"></div>
        <div class="files" id="fileList"></div>
      </div>
      <div id="jsonContent" class="json-content"></div>
    </div>

    <script>
      const baseUrl = "https://lowkeyboard.github.io/langlang";
      const categories = {
        wordsets: {
          path: "wordsets/wordset_one",
          files: ["wordset_1_german.json", "wordset_1_french.json"],
        },
        categories_reading: {
          path: "categories_reading",
          subcategories: {
            greetings: [
              "greetings_page1_german.json",
              "greetings_page1_french.json",
              "greetings_page1_italian.json",
            ],
            daily_routines: ["daily_routines_french.json"],
            shopping: ["shopping_italian.json"],
            travel: ["travel_spanish.json"],
            family: ["family_german.json"],
          },
        },
      };

      function updatePaths(path, isFile = false) {
        const urlPathDiv = document.getElementById("urlPath");
        const segments = path.split("/");
        urlPathDiv.innerHTML = "";

        segments.forEach((segment, index) => {
          const segmentSpan = document.createElement("span");
          segmentSpan.className = "path-segment";
          segmentSpan.textContent = segment;
          urlPathDiv.appendChild(segmentSpan);

          if (index < segments.length - 1) {
            const separator = document.createElement("span");
            separator.className = "path-separator";
            separator.textContent = " / ";
            urlPathDiv.appendChild(separator);
          }
        });

        const fullUrlDiv = document.getElementById("fullUrl");
        if (isFile) {
          fullUrlDiv.textContent = `${baseUrl}/${path}`;
        } else {
          fullUrlDiv.textContent = baseUrl;
        }
      }

      function getFolderDisplayName(folder) {
        const displayNames = {
          wordsets: "Word Sets",
          categories_reading: "Reading Categories",
          greetings: "Greetings & Introductions",
          daily_routines: "Daily Routines",
          shopping: "Shopping & Money",
          travel: "Travel & Directions",
          family: "Family & Friends",
        };
        return displayNames[folder] || folder;
      }

      function displayFolders() {
        const folderList = document.getElementById("folderList");
        folderList.innerHTML = "<h2>Categories</h2>";

        Object.keys(categories).forEach((category) => {
          const folderDiv = document.createElement("div");
          folderDiv.className = "folder";
          folderDiv.textContent = getFolderDisplayName(category);
          folderDiv.onclick = () => {
            if (category === "wordsets") {
              loadWordsetFiles(categories[category].path);
            } else {
              loadSubcategories(category);
            }
            updatePaths(category);
          };
          folderList.appendChild(folderDiv);
        });
      }

      function loadSubcategories(category) {
        const fileList = document.getElementById("fileList");
        fileList.innerHTML = "<h2>Subcategories</h2>";
        document.getElementById("jsonContent").innerHTML = "";

        const subcategories = categories[category].subcategories;
        Object.keys(subcategories).forEach((subcat) => {
          const folderDiv = document.createElement("div");
          folderDiv.className = "folder";
          folderDiv.textContent = getFolderDisplayName(subcat);
          folderDiv.onclick = () => {
            loadCategoryFiles(category, subcat);
            updatePaths(`${category}/${subcat}`);
          };
          fileList.appendChild(folderDiv);
        });
      }

      function loadWordsetFiles(path) {
        const fileList = document.getElementById("fileList");
        fileList.innerHTML = "<h2>Available Files</h2>";
        document.getElementById("jsonContent").innerHTML = "";

        categories.wordsets.files.forEach((file) => {
          const fileDiv = document.createElement("div");
          fileDiv.className = "file";
          const language = file.split("_").pop().split(".")[0];
          fileDiv.textContent =
            language.charAt(0).toUpperCase() + language.slice(1);
          fileDiv.onclick = () => {
            const fullPath = `${path}/${file}`;
            fetchAndDisplayJson(`${baseUrl}/${fullPath}`);
            updatePaths(fullPath, true);
          };
          fileList.appendChild(fileDiv);
        });
      }

      function loadCategoryFiles(category, subcategory) {
        const fileList = document.getElementById("fileList");
        fileList.innerHTML = "<h2>Available Files</h2>";
        document.getElementById("jsonContent").innerHTML = "";

        const files = categories[category].subcategories[subcategory];
        files.forEach((file) => {
          const fileDiv = document.createElement("div");
          fileDiv.className = "file";
          const language = file.split("_").pop().split(".")[0];
          fileDiv.textContent =
            language.charAt(0).toUpperCase() + language.slice(1);
          fileDiv.onclick = () => {
            const fullPath = `${category}/${subcategory}/${file}`;
            fetchAndDisplayJson(`${baseUrl}/${fullPath}`);
            updatePaths(fullPath, true);
          };
          fileList.appendChild(fileDiv);
        });
      }

      async function fetchAndDisplayJson(url) {
        const contentDiv = document.getElementById("jsonContent");
        contentDiv.innerHTML = "Loading...";

        try {
          const response = await fetch(url);
          if (!response.ok) {
            throw new Error("Network response was not ok");
          }
          const data = await response.json();

          // Create copy button
          const copyButton = document.createElement("button");
          copyButton.className = "copy-button";
          copyButton.textContent = "Copy All";
          copyButton.onclick = () => copyJsonToClipboard(data);

          // Format and display the JSON
          const preElement = document.createElement("pre");
          preElement.textContent = JSON.stringify(data, null, 2);

          contentDiv.innerHTML = "";
          contentDiv.appendChild(copyButton);
          contentDiv.appendChild(preElement);
        } catch (error) {
          console.error("Error fetching JSON:", error);
          contentDiv.innerHTML = `<p class="error">Error loading JSON file: ${error.message}</p>`;
        }
      }

      async function copyJsonToClipboard(data) {
        try {
          const jsonString = JSON.stringify(data, null, 2);
          await navigator.clipboard.writeText(jsonString);

          // Visual feedback
          const copyButton = document.querySelector(".copy-button");
          copyButton.textContent = "Copied!";
          copyButton.classList.add("copied");

          // Reset button after 2 seconds
          setTimeout(() => {
            copyButton.textContent = "Copy All";
            copyButton.classList.remove("copied");
          }, 2000);
        } catch (error) {
          console.error("Failed to copy:", error);
        }
      }

      // Initialize the folder list when the page loads
      displayFolders();
    </script>
  </body>
</html>
